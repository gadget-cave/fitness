<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Members Panel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #eef; }
    table, th, td { border: 1px solid black; border-collapse: collapse; }
    table { width: 100%; margin-top: 20px; }
    td, th { padding: 8px; }
    input, button { padding: 10px; margin: 5px; }
    .actions button { margin: 2px; }
  </style>
</head>
<body>
  <h2>Add Member</h2>
  <input type="text" id="name" placeholder="Name">
  <input type="text" id="mobile" placeholder="Mobile Number">
  <input type="date" id="start">
  <input type="number" id="amount" placeholder="Paid Amount">
  <button onclick="addMember()">Add Member</button>

  <input type="text" id="search" onkeyup="render()" placeholder="Search by name or number">
  <button onclick="exportAllPDF()">Export All to PDF</button>

  <table id="memberTable">
    <thead>
      <tr>
        <th>Name</th><th>Mobile</th><th>Start</th><th>Paid</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let members = JSON.parse(localStorage.getItem("members") || "[]");

    function addMember() {
      const name = document.getElementById("name").value;
      const mobile = document.getElementById("mobile").value;
      const start = document.getElementById("start").value;
      const amount = document.getElementById("amount").value;
      members.push({ name, mobile, start, amount });
      localStorage.setItem("members", JSON.stringify(members));
      render();
    }

    function render() {
      const search = document.getElementById("search").value.toLowerCase();
      const tbody = document.querySelector("#memberTable tbody");
      tbody.innerHTML = "";
      members.filter(m => m.name.toLowerCase().includes(search) || m.mobile.includes(search))
        .forEach((m, i) => {
          tbody.innerHTML += `<tr>
            <td>${m.name}</td><td>${m.mobile}</td><td>${m.start}</td><td>${m.amount}</td>
            <td class="actions">
              <button onclick="whatsapp('${m.mobile}', '${m.name}')">WhatsApp</button>
              <button onclick="edit(${i})">Edit</button>
              <button onclick="del(${i})">Delete</button>
              <button onclick="exportSinglePDF(${i})">Export</button>
            </td>
          </tr>`;
        });
    }

    function whatsapp(mobile, name) {
      const message = encodeURIComponent(`Hi ${name}, kindly pay your gym fee soon. Thank you!`);
      window.open(`https://wa.me/91${mobile}?text=${message}`, '_blank');
    }

    function edit(i) {
      const m = members[i];
      const name = prompt("Edit name", m.name);
      const mobile = prompt("Edit mobile", m.mobile);
      const start = prompt("Edit start date", m.start);
      const amount = prompt("Edit amount", m.amount);
      members[i] = { name, mobile, start, amount };
      localStorage.setItem("members", JSON.stringify(members));
      render();
    }

    function del(i) {
      if (confirm("Are you sure to delete?")) {
        members.splice(i, 1);
        localStorage.setItem("members", JSON.stringify(members));
        render();
      }
    }

    function exportSinglePDF(i) {
      const { jsPDF } = window.jspdf;
      const m = members[i];
      const doc = new jsPDF();
      doc.text(`Name: ${m.name}\nMobile: ${m.mobile}\nStart Date: ${m.start}\nPaid Amount: ₹${m.amount}`, 10, 10);
      doc.save(`${m.name}_details.pdf`);
    }

    function exportAllPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      members.forEach((m, i) => {
        doc.text(`${i + 1}. ${m.name} - ${m.mobile} - ₹${m.amount}`, 10, 10 + i * 10);
      });
      doc.save("all_members.pdf");
    }

    if (localStorage.getItem("loggedIn") === "yes") render();
    else location.href = "index.html";
  </script>
</body>
</html>
