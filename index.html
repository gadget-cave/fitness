<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial;
            margin: 20px;
            background-color: #f2f2f2;
        }
        .container {
            max-width: 700px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
        }
        h1 {
            text-align: center;
        }
        .hidden { display: none; }
        label { display: block; margin-top: 10px; }
        input { width: 100%; padding: 8px; }
        button { padding: 10px; margin-top: 15px; width: 100%; cursor: pointer; }
        .member {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="loginSection">
        <h1>Login</h1>
        <input type="text" id="mobile" placeholder="Enter Mobile Number">
        <input type="password" id="password" placeholder="Enter Password">
        <button onclick="login()">Login</button>
    </div>

    <div id="homeSection" class="hidden">
        <h1>Member Management</h1>

        <label>Name:</label>
        <input type="text" id="name">

        <label>Phone Number:</label>
        <input type="text" id="phone">

        <label>Payment Plan:</label>
        <input type="text" id="plan">

        <label>Payment Date:</label>
        <input type="date" id="paymentDate">

        <label>Starting Date:</label>
        <input type="date" id="startingDate">

        <label>Paid Amount:</label>
        <input type="number" id="paidAmount">

        <button onclick="addMember()">Add/Update Member</button>
        <button onclick="exportAllPDF()">Export All to PDF</button>

        <div id="members"></div>
    </div>

    <div id="unauth" class="hidden">
        <h1>How are you?</h1>
    </div>
</div>

<script>
    const ADMIN_MOBILE = "917994160120";
    const ADMIN_PASS = "hisham@123";

    function login() {
        const mobile = document.getElementById("mobile").value;
        const password = document.getElementById("password").value;
        if (mobile === ADMIN_MOBILE && password === ADMIN_PASS) {
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("homeSection").classList.remove("hidden");
            loadMembers();
        } else {
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("unauth").classList.remove("hidden");
        }
    }

    function getMembers() {
        return JSON.parse(localStorage.getItem("members")) || [];
    }

    function saveMembers(members) {
        localStorage.setItem("members", JSON.stringify(members));
    }

    function addMember() {
        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const plan = document.getElementById("plan").value;
        const paymentDate = document.getElementById("paymentDate").value;
        const startingDate = document.getElementById("startingDate").value;
        const paidAmount = document.getElementById("paidAmount").value;

        if (!name || !phone || !plan || !paymentDate) return alert("Fill all required fields");

        const members = getMembers();
        const existing = members.find(m => m.phone === phone);

        if (existing) {
            Object.assign(existing, { name, plan, paymentDate, startingDate, paidAmount });
        } else {
            members.push({ name, phone, plan, paymentDate, startingDate, paidAmount });
        }

        saveMembers(members);
        loadMembers();
    }

    function loadMembers() {
        const members = getMembers();
        const div = document.getElementById("members");
        div.innerHTML = "";
        members.forEach((m, i) => {
            div.innerHTML += `
                <div class="member">
                    <strong>${m.name}</strong><br>
                    üìû ${m.phone}<br>
                    üí≥ ${m.plan}<br>
                    üóìÔ∏è Payment: ${m.paymentDate}<br>
                    üöÄ Start: ${m.startingDate || 'N/A'}<br>
                    üí∞ Paid: ‚Çπ${m.paidAmount || 'N/A'}<br>
                    <button onclick='fillForm(${i})'>Edit</button>
                    <button onclick='exportPDF(${i})'>Export PDF</button>
                </div>
            `;
        });
    }

    function fillForm(index) {
        const m = getMembers()[index];
        document.getElementById("name").value = m.name;
        document.getElementById("phone").value = m.phone;
        document.getElementById("plan").value = m.plan;
        document.getElementById("paymentDate").value = m.paymentDate;
        document.getElementById("startingDate").value = m.startingDate || "";
        document.getElementById("paidAmount").value = m.paidAmount || "";
    }

    function exportPDF(index) {
        const { jsPDF } = window.jspdf;
        const m = getMembers()[index];
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text(`Member Details`, 10, 10);
        doc.setFontSize(12);
        doc.text(`Name: ${m.name}`, 10, 20);
        doc.text(`Phone: ${m.phone}`, 10, 30);
        doc.text(`Plan: ${m.plan}`, 10, 40);
        doc.text(`Payment Date: ${m.paymentDate}`, 10, 50);
        doc.text(`Starting Date: ${m.startingDate || 'N/A'}`, 10, 60);
        doc.text(`Paid Amount: ‚Çπ${m.paidAmount || 'N/A'}`, 10, 70);
        doc.save(`${m.name}_${m.phone}.pdf`);
    }

    function exportAllPDF() {
        const { jsPDF } = window.jspdf;
        const members = getMembers();
        const doc = new jsPDF();
        let y = 10;
        doc.setFontSize(14);
        doc.text(`All Members`, 10, y);
        y += 10;

        members.forEach((m, idx) => {
            if (y > 270) {
                doc.addPage();
                y = 10;
            }
            doc.setFontSize(12);
            doc.text(`${idx + 1}. Name: ${m.name}, Phone: ${m.phone}, Plan: ${m.plan}, Payment: ${m.paymentDate}, Start: ${m.startingDate || 'N/A'}, Paid: ‚Çπ${m.paidAmount || 'N/A'}`, 10, y);
            y += 10;
        });

        doc.save("All_Members.pdf");
    }
</script>
</body>
</html>
